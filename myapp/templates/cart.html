{% extends "header.html" %}
{% load static %}
{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
	<script src="https://js.stripe.com/v3/"></script>
</head>
<body>

	<!-- search area -->
	<div class="search-area">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<span class="close-btn"><i class="fas fa-window-close"></i></span>
					<div class="search-bar">
						<div class="search-bar-tablecell">
							<h3>Search For:</h3>
							<input type="text" placeholder="Keywords">
							<button type="submit">Search <i class="fas fa-search"></i></button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end search arewa -->
	
	<!-- breadcrumb-section -->
	<div class="breadcrumb-section breadcrumb-bg">
		<div class="container">
			<div class="row">
				<div class="col-lg-8 offset-lg-2 text-center">
					<div class="breadcrumb-text">
						<p>Fresh and Organic</p>
						<h1>Cart</h1>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end breadcrumb section -->

	<!-- cart -->
	<div class="cart-section mt-150 mb-150">
		<div class="container">
			<div class="row">
				<div class="col-lg-8 col-md-12">
					<div class="cart-table-wrap">
						<table class="cart-table">
							<thead class="cart-table-head">
								<tr class="table-head-row">
									<th class="product-image">Product Image</th>
									<th class="product-name">Name</th>
									<th class="product-price">Price</th>
									<th class="product-quantity">Quantity</th>
									<th class="product-total">Total</th>
								</tr>
							</thead>
							<tbody>
								{% for i in carts %}
								<tr class="table-body-row">
									<td class="product-image"><img src="{{i.product.product_image.url}}" alt=""></td>
									<td class="product-name">{{i.product.product_name}}</td>
									<td class="product-price">{{i.product.product_price}} Rs</td>
									<td class="product-quantity"><div class="product_count">
									<form name="change_qty" method="post" action="{% url 'change-qty' %}">
										{% csrf_token %}
										<input type="hidden" name="cid" value="{{i.pk}}">
										<input type="number" name="product_qty" value="{{i.product_qty}}" min="1" max="10" onchange="this.form.submit();">
									</form>
									</div></td>
								</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
				</div>

				<div class="col-lg-4">
					<div class="total-section">
						<table class="total-table">
							<thead class="total-table-head">
								<tr class="table-total-row">
									<th>Total</th>
									<th>Price</th>
								</tr>
							</thead>
							<tbody>
								<tr class="total-data">
									<td><strong>Subtotal: </strong></td>
									<td>{{net_price}} Rs</td>
								</tr>
								<tr class="total-data">
									<td><strong>Shipping: </strong></td>
									<td>FREE</td>
								</tr>
								<tr class="total-data">
									<td><strong>Total: </strong></td>
									<td>{{net_price}} Rs</td>
								</tr>
							</tbody>
						</table>
						<div class="cart-buttons">
							<form method="post">
								{% csrf_token %}
								<input type="hidden" id="net_price" name="amount" value="{{net_price}}">

								<button
									type="button"
									id="checkout-button"
									style="
										background-color:#f28123;
										color:#fff;
										border:none;
										padding:14px 28px;
										font-size:16px;
										font-weight:600;
										border-radius:6px;
										cursor:pointer;
										transition:all 0.3s ease;
										width:100%;
									"
									onmouseover="this.style.backgroundColor='#b75b05ff'"
									onmouseout="this.style.backgroundColor='#f28123'"
								>
									Proceed Checkout
								</button>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end cart -->

<script type="text/javascript">

var stripe = Stripe('pk_test_51MshH6SJuXwPfjjrrgxJ5tubbOgYAhRrqNcd4RDUSq1peWpIMZrjhIiTncSUWO9u6byeDf4KxdZPkFD4hU55mVOg00aRL5RT8x');
var checkoutButton = document.getElementById('checkout-button');

checkoutButton.addEventListener('click', function() { 
 fetch('/create-checkout-session/', {
 method: 'POST',
    headers:{
        'Accept': 'application/json',
        'X-Requested-With': 'XMLHttpRequest', //Necessary to work with request.is_ajax()

    },
    body: JSON.stringify({'post_data':'{{net_price}}'})
 })
 .then(function(response) {
 return response.json();
 })
 .then(function(session) {
 return stripe.redirectToCheckout({ sessionId: session.id });
 })
 .then(function(result) {
 // If `redirectToCheckout` fails due to a browser or network
 // error, you should display the localized error message to your
 // customer using `error.message`.
 if (result.error) {
 alert(result.error.message);
 }
 })
 .catch(function(error) {
 console.error('Error:', error);
 });
 });
 </script>

</body>
</html>
{% endblock %}